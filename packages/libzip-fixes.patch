diff -ru libzip-1.3.0.orig/lib/zip.h libzip-1.3.0/lib/zip.h
--- libzip-1.3.0.orig/lib/zip.h	2017-06-21 00:09:33.000000000 +0200
+++ libzip-1.3.0/lib/zip.h	2017-11-13 13:15:36.798634020 +0100
@@ -37,9 +37,9 @@
 
 #ifndef ZIP_EXTERN
 # ifndef ZIP_STATIC
-#  ifdef _WIN32
+#  ifdef _MSC_VER
 #   define ZIP_EXTERN __declspec(dllimport)
-#  elif defined(__GNUC__) && __GNUC__ >= 4
+#  elif (defined(__GNUC__) && __GNUC__ >= 4) && !defined(_WIN32)
 #   define ZIP_EXTERN __attribute__ ((visibility ("default")))
 #  else
 #   define ZIP_EXTERN
diff -ru libzip-1.3.0.orig/libzip.pc.in libzip-1.3.0/libzip.pc.in
--- libzip-1.3.0.orig/libzip.pc.in	2017-03-24 10:22:29.000000000 +0100
+++ libzip-1.3.0/libzip.pc.in	2017-11-13 13:16:10.935511427 +0100
@@ -9,6 +9,7 @@
 Name: libzip
 Description: library for handling zip archives
 Version: @VERSION@
-Libs: @PKG_CONFIG_RPATH@ -L${libdir} -lzip @LIBS@
+Libs: @PKG_CONFIG_RPATH@ -L${libdir} -lzip
+Libs.private: -lbz2
 Cflags: -I${includedir} -I${libincludedir}
-
+Requires.private: zlib
diff -ru libzip-1.3.0.orig/Makefile.am libzip-1.3.0/Makefile.am
--- libzip-1.3.0.orig/Makefile.am	2017-03-24 10:22:29.000000000 +0100
+++ libzip-1.3.0/Makefile.am	2017-11-13 13:15:36.798634020 +0100
@@ -3,7 +3,7 @@
 
 ACLOCAL_AMFLAGS=	-I m4
 
-SUBDIRS=lib man src regress examples
+SUBDIRS=lib
 
 pkgconfigdir = $(libdir)/pkgconfig
 pkgconfig_DATA = libzip.pc
